import{d as I,a as c,r as V,b as n,o as x,c as U,w as r,e as d,f as a,g as u,k as q,l as G,h as R,n as w,E as A,j as F,p as z,i as j,_ as D}from"./index-01cbf18e.js";import{s as L,f as H}from"./medical-c6f0a0f6.js";import{A as J}from"./AnimatedBackground-5c67056e.js";const C=f=>(z("data-v-59e764af"),f=f(),j(),f),K={class:"forgot-password"},O={class:"is-forgot-password"},Q=C(()=>d("h3",{class:"title"},"云链·医问",-1)),W=C(()=>d("h4",{class:"subtitle"},"忘记密码",-1)),X={class:"verification-code-container"},Y={key:0,class:"verification-image-container"},Z=["src"],ee={class:"form-group"},oe={class:"login-link"},te=I({__name:"ForgotPassword",setup(f){const g=c(null),p=c(!1),_=c(!1);c("发送验证码");const h=c(""),P=V({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:1,max:10,message:"用户名长度应在1到10个字符之间",trigger:"blur"}],password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:12,message:"密码长度应在6到12个字符之间",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(i,e,t)=>{e===""?t(new Error("请再次输入密码")):e!==o.password?t(new Error("两次输入密码不一致!")):t()},trigger:"blur"}],userType:[{required:!0,message:"请选择用户类型",trigger:"change"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],inputCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),o=V({userName:"",password:"",confirmPassword:"",userType:1,email:"",code:"",inputCode:""}),S=i=>{const e=document.createElement("canvas"),t=e.getContext("2d");if(e.width=120,e.height=40,t){t.fillStyle="#f0f2f5",t.fillRect(0,0,e.width,e.height);for(let l=0;l<3;l++)t.strokeStyle=`rgb(${Math.floor(Math.random()*200)}, ${Math.floor(Math.random()*200)}, ${Math.floor(Math.random()*200)})`,t.beginPath(),t.moveTo(Math.random()*e.width,Math.random()*e.height),t.lineTo(Math.random()*e.width,Math.random()*e.height),t.stroke();for(let l=0;l<30;l++)t.fillStyle=`rgb(${Math.floor(Math.random()*200)}, ${Math.floor(Math.random()*200)}, ${Math.floor(Math.random()*200)})`,t.beginPath(),t.arc(Math.random()*e.width,Math.random()*e.height,1,0,2*Math.PI),t.fill();return t.fillStyle="#4a9e5c",t.font="bold 24px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(i,e.width/2,e.height/2),e.toDataURL("image/png")}return""},k=()=>{o.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)&&v()},v=()=>{if(!o.email){A.warning("请先输入邮箱");return}_.value=!0,L(o.email).then(i=>{i.code==200&&(o.code=i.verificationCode,h.value=S(o.code)),_.value=!1}).catch(i=>{console.log(i),_.value=!1})},N=()=>{v()},y=()=>{if(!g.value){console.log("formRef is null");return}g.value.validate(i=>{if(i){if(o.inputCode!==o.code){alert("验证码错误，请重新输入");return}p.value=!0,H(o.userName,o.userType,o.password).then(e=>{setTimeout(()=>{e.code==200?(alert("密码重置成功!"),F.push("/login")):alert(e.data.msg),p.value=!1},1e3)}).catch(e=>{console.log(e),p.value=!1})}})},T=()=>{o.userName="",o.password="",o.confirmPassword="",o.userType=1,o.email="",o.inputCode="",o.code=""};return(i,e)=>{const t=n("el-input"),l=n("el-form-item"),b=n("el-radio"),$=n("el-radio-group"),B=n("el-form"),M=n("el-button"),E=n("router-link");return x(),U(J,null,{default:r(({themeColors:m})=>[d("div",K,[d("div",O,[Q,W,a(B,{ref_key:"formRef",ref:g,model:o,rules:P,onSubmit:R(y,["prevent"]),style:{"max-width":"400px"},"label-width":"auto",class:"forgot-password-form"},{default:r(()=>[a(l,{label:"用户名",prop:"userName"},{default:r(()=>[a(t,{style:{width:"300px"},type:"text",class:"form-control",id:"userName",placeholder:"请输入用户名",autocomplete:"off",modelValue:o.userName,"onUpdate:modelValue":e[0]||(e[0]=s=>o.userName=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),a(l,{label:"用户类型",prop:"userType"},{default:r(()=>[a($,{modelValue:o.userType,"onUpdate:modelValue":e[1]||(e[1]=s=>o.userType=s)},{default:r(()=>[a(b,{value:1,size:"small"},{default:r(()=>[u("患者")]),_:1}),a(b,{value:2,size:"small"},{default:r(()=>[u("医生")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(l,{label:"邮箱",prop:"email"},{default:r(()=>[a(t,{style:{width:"300px"},type:"email",class:"form-control",id:"email",placeholder:"请输入邮箱",autocomplete:"off",modelValue:o.email,"onUpdate:modelValue":e[2]||(e[2]=s=>o.email=s),modelModifiers:{trim:!0},onBlur:k},null,8,["modelValue"])]),_:1}),a(l,{label:"验证码",prop:"inputCode"},{default:r(()=>[d("div",X,[a(t,{style:{width:"200px"},type:"text",class:"form-control",id:"verification-code",placeholder:"请输入验证码",autocomplete:"off",modelValue:o.inputCode,"onUpdate:modelValue":e[3]||(e[3]=s=>o.inputCode=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),h.value?(x(),q("div",Y,[d("img",{src:h.value,alt:"验证码",class:"verification-image",onClick:N,title:"点击刷新验证码"},null,8,Z)])):G("",!0)]),_:1}),a(l,{label:"新密码",prop:"password"},{default:r(()=>[a(t,{style:{width:"300px"},type:"password",class:"form-control",id:"password",placeholder:"请输入新密码",autocomplete:"off",modelValue:o.password,"onUpdate:modelValue":e[4]||(e[4]=s=>o.password=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),a(l,{label:"确认密码",prop:"confirmPassword"},{default:r(()=>[a(t,{style:{width:"300px"},type:"password",class:"form-control",id:"confirmPassword",placeholder:"请确认新密码",autocomplete:"off",modelValue:o.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=s=>o.confirmPassword=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),d("div",ee,[a(M,{type:"primary",class:"submit-btn",onClick:y,loading:p.value,style:w({background:`linear-gradient(135deg, ${m.buttonGradientStart} 0%, ${m.buttonGradientEnd} 100%)`})},{default:r(()=>[u("重置密码")]),_:2},1032,["loading","style"]),a(M,{class:"reset-btn",onClick:T,style:w({borderColor:m.buttonGradientStart,color:m.buttonGradientStart})},{default:r(()=>[u("重置")]),_:2},1032,["style"])]),d("div",oe,[d("p",null,[u("想起密码？"),a(E,{style:w({color:m.buttonGradientStart}),to:"/login"},{default:r(()=>[u("点击登录")]),_:2},1032,["style"])])])])])]),_:1})}}});const ie=D(te,[["__scopeId","data-v-59e764af"]]);export{ie as default};
